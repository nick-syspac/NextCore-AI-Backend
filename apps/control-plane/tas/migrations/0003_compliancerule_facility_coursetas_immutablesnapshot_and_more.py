# Generated by Django 5.1.2 on 2025-10-26 10:47

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('tas', '0002_rename_tas_documen_tenant__4ac7ea_idx_tas_documen_tenant__80c323_idx_and_more'),
        ('tenants', '0003_tenantapikey_description'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ComplianceRule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('rule_type', models.CharField(choices=[('packaging', 'Packaging Rules'), ('trainer_scope', 'Trainer Scope'), ('facility_adequacy', 'Facility Adequacy'), ('hours_validation', 'Hours Validation'), ('clustering', 'Clustering Sanity'), ('policy', 'Policy Compliance')], max_length=50)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField()),
                ('rule_logic', models.JSONField(default=dict, help_text='Rule implementation as JSON (e.g., conditions, thresholds)')),
                ('severity', models.CharField(choices=[('red', 'Red - Blocking'), ('amber', 'Amber - Warning'), ('green', 'Green - Advisory')], max_length=20)),
                ('asqa_clause', models.CharField(blank=True, help_text='e.g., 1.1, 1.13, 2.2', max_length=50)),
                ('is_active', models.BooleanField(default=True)),
                ('is_system_rule', models.BooleanField(default=False, help_text='System rules cannot be deleted')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('tenant', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='compliance_rules', to='tenants.tenant')),
            ],
            options={
                'verbose_name': 'Compliance Rule',
                'verbose_name_plural': 'Compliance Rules',
                'db_table': 'tas_compliance_rules',
                'ordering': ['rule_type', 'name'],
            },
        ),
        migrations.CreateModel(
            name='Facility',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200)),
                ('facility_type', models.CharField(choices=[('classroom', 'Classroom'), ('workshop', 'Workshop'), ('lab', 'Laboratory'), ('online', 'Online Platform'), ('simulated', 'Simulated Environment')], max_length=50)),
                ('location', models.CharField(blank=True, max_length=300)),
                ('capacity', models.IntegerField(default=0)),
                ('rooms', models.JSONField(default=list, help_text='List of rooms/spaces')),
                ('equipment', models.JSONField(default=list, help_text='Equipment inventory')),
                ('software', models.JSONField(default=list, help_text='Software licenses and tools')),
                ('is_available', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='facilities', to='tenants.tenant')),
            ],
            options={
                'verbose_name': 'Facility',
                'verbose_name_plural': 'Facilities',
                'db_table': 'tas_facilities',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='CourseTAS',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('qualification_code', models.CharField(help_text='e.g., BSB50120', max_length=50)),
                ('qualification_name', models.CharField(max_length=300)),
                ('aqf_level', models.CharField(choices=[('certificate_i', 'Certificate I'), ('certificate_ii', 'Certificate II'), ('certificate_iii', 'Certificate III'), ('certificate_iv', 'Certificate IV'), ('diploma', 'Diploma'), ('advanced_diploma', 'Advanced Diploma'), ('graduate_certificate', 'Graduate Certificate'), ('graduate_diploma', 'Graduate Diploma'), ('bachelor', 'Bachelor Degree'), ('masters', 'Masters Degree')], max_length=50)),
                ('training_package', models.CharField(blank=True, max_length=100)),
                ('tga_qualification_snapshot', models.JSONField(default=dict, help_text='TGA data snapshot at creation')),
                ('tga_release_version', models.CharField(blank=True, max_length=50)),
                ('core_units', models.JSONField(default=list, help_text='Core unit codes and titles')),
                ('elective_units', models.JSONField(default=list, help_text='Selected elective unit codes and titles')),
                ('total_units', models.IntegerField(default=0)),
                ('cohort_profile', models.TextField(help_text='Target cohort description and contextualization')),
                ('delivery_model', models.CharField(help_text='Face-to-face, Online, Blended, etc.', max_length=100)),
                ('total_hours', models.IntegerField(default=0, help_text='Total nominal hours')),
                ('duration_weeks', models.IntegerField(default=52)),
                ('clusters', models.JSONField(default=list, help_text='Unit clusters with sequencing and hours')),
                ('resources', models.JSONField(default=list, help_text='Facilities, equipment, materials required')),
                ('assessment_overview', models.TextField(blank=True, help_text='High-level assessment strategy')),
                ('validation_plan', models.JSONField(default=dict, help_text='Validation schedule and approach')),
                ('policy_links', models.JSONField(default=list, help_text='Links to RTO policies (RPL, Assessment, LLN, etc.)')),
                ('compliance_notes', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('review', 'In Review'), ('approved', 'Approved'), ('published', 'Published'), ('archived', 'Archived')], default='draft', max_length=20)),
                ('version', models.IntegerField(default=1)),
                ('is_current_version', models.BooleanField(default=True)),
                ('submitted_for_review_at', models.DateTimeField(blank=True, null=True)),
                ('reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('published_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='course_tas_approved', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='course_tas_created', to=settings.AUTH_USER_MODEL)),
                ('reviewed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='course_tas_reviewed', to=settings.AUTH_USER_MODEL)),
                ('submitted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='course_tas_submitted', to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='course_tas', to='tenants.tenant')),
                ('facilities', models.ManyToManyField(blank=True, related_name='course_tas_assignments', to='tas.facility')),
            ],
            options={
                'verbose_name': 'Course TAS',
                'verbose_name_plural': 'Course TAS Documents',
                'db_table': 'tas_course_tas',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ImmutableSnapshot',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('snapshot_data', models.JSONField(help_text='Complete frozen state of CourseTAS and all UnitTAS')),
                ('version', models.IntegerField()),
                ('checksum', models.CharField(help_text='SHA-256 hash of snapshot data', max_length=64)),
                ('snapshot_reason', models.CharField(help_text="e.g., 'Initial Approval', 'Version Update'", max_length=100)),
                ('evidence_pack_links', models.JSONField(default=list, help_text='Links to supporting evidence')),
                ('sealed_at', models.DateTimeField(auto_now_add=True)),
                ('auditor_link_token', models.CharField(blank=True, help_text='Secure token for auditor access', max_length=100)),
                ('auditor_link_expires_at', models.DateTimeField(blank=True, null=True)),
                ('course_tas', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='snapshots', to='tas.coursetas')),
                ('sealed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Immutable Snapshot',
                'verbose_name_plural': 'Immutable Snapshots',
                'db_table': 'tas_immutable_snapshots',
                'ordering': ['-sealed_at'],
            },
        ),
        migrations.CreateModel(
            name='EvidencePack',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('industry_engagement_links', models.JSONField(default=list, help_text='Links to IndustryEngagement records')),
                ('validation_evidence', models.JSONField(default=list, help_text='Validation meeting notes, reports')),
                ('policy_documents', models.JSONField(default=list, help_text='Linked RTO policy documents')),
                ('trainer_credentials', models.JSONField(default=list, help_text='Trainer qualifications and currency evidence')),
                ('facility_documentation', models.JSONField(default=list, help_text='Facility and resource evidence')),
                ('change_log', models.JSONField(default=list, help_text='History of changes and justifications')),
                ('compiled_at', models.DateTimeField(auto_now_add=True)),
                ('export_file_path', models.CharField(blank=True, help_text='Path to exported evidence bundle', max_length=500)),
                ('compiled_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('course_tas', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='evidence_packs', to='tas.coursetas')),
                ('snapshot', models.OneToOneField(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='evidence_pack', to='tas.immutablesnapshot')),
            ],
            options={
                'verbose_name': 'Evidence Pack',
                'verbose_name_plural': 'Evidence Packs',
                'db_table': 'tas_evidence_packs',
                'ordering': ['-compiled_at'],
            },
        ),
        migrations.CreateModel(
            name='IndustryEngagement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('engagement_type', models.CharField(choices=[('consultation', 'Industry Consultation'), ('validation', 'Curriculum Validation'), ('advisory', 'Advisory Committee'), ('partnership', 'Industry Partnership'), ('feedback', 'Employer Feedback')], max_length=50)),
                ('employer_name', models.CharField(max_length=300)),
                ('contact_person', models.CharField(blank=True, max_length=200)),
                ('engagement_date', models.DateField()),
                ('notes', models.TextField(help_text='Summary of engagement and outcomes')),
                ('outcomes', models.JSONField(default=list, help_text='Key outcomes and action items')),
                ('recommendations', models.JSONField(default=list, help_text='Industry recommendations')),
                ('related_qualifications', models.JSONField(default=list, help_text='Related qualification codes')),
                ('attachments', models.JSONField(default=list, help_text='Supporting documentation links')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('recorded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='industry_engagements', to='tenants.tenant')),
            ],
            options={
                'verbose_name': 'Industry Engagement',
                'verbose_name_plural': 'Industry Engagements',
                'db_table': 'tas_industry_engagements',
                'ordering': ['-engagement_date'],
            },
        ),
        migrations.AddField(
            model_name='coursetas',
            name='industry_engagements',
            field=models.ManyToManyField(blank=True, related_name='course_tas_links', to='tas.industryengagement'),
        ),
        migrations.CreateModel(
            name='QualificationCache',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('qualification_code', models.CharField(db_index=True, max_length=20, unique=True)),
                ('qualification_title', models.CharField(max_length=500)),
                ('training_package', models.CharField(blank=True, max_length=20)),
                ('aqf_level', models.CharField(blank=True, max_length=50)),
                ('packaging_rules', models.TextField(blank=True)),
                ('has_groupings', models.BooleanField(default=False)),
                ('groupings', models.JSONField(default=list, help_text='List of groupings with units: [{name, type, required, units: [{code, title, type}]}]')),
                ('source', models.CharField(default='training.gov.au', help_text='Data source (training.gov.au, manual, etc.)', max_length=50)),
                ('last_updated', models.DateTimeField(auto_now=True)),
                ('is_active', models.BooleanField(default=True)),
                ('release_date', models.DateField(blank=True, null=True)),
            ],
            options={
                'verbose_name': 'Qualification Cache',
                'verbose_name_plural': 'Qualification Cache',
                'db_table': 'tas_qualification_cache',
                'ordering': ['qualification_code'],
                'indexes': [models.Index(fields=['qualification_code', 'is_active'], name='tas_qualifi_qualifi_1c40c7_idx'), models.Index(fields=['training_package'], name='tas_qualifi_trainin_fc0c9c_idx')],
            },
        ),
        migrations.CreateModel(
            name='Trainer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('qualifications', models.JSONField(default=list, help_text='List of trainer qualifications')),
                ('tae_qualification', models.CharField(blank=True, help_text='TAE40116 or equivalent', max_length=100)),
                ('industry_experience_years', models.IntegerField(default=0)),
                ('currency_activities', models.JSONField(default=list, help_text='Recent industry currency activities')),
                ('last_currency_date', models.DateField(blank=True, null=True)),
                ('scope_units', models.JSONField(default=list, help_text='Unit codes the trainer is qualified to deliver')),
                ('specializations', models.JSONField(default=list, help_text='Areas of specialization')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('tenant', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trainers', to='tenants.tenant')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trainer_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Trainer',
                'verbose_name_plural': 'Trainers',
                'db_table': 'tas_trainers',
            },
        ),
        migrations.CreateModel(
            name='UnitTAS',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('unit_code', models.CharField(max_length=50)),
                ('unit_title', models.CharField(max_length=300)),
                ('unit_type', models.CharField(choices=[('core', 'Core'), ('elective', 'Elective')], max_length=20)),
                ('nominal_hours', models.IntegerField(default=0)),
                ('tga_unit_snapshot', models.JSONField(default=dict, help_text='Elements, PC, KE, FS from TGA')),
                ('cluster_assignment', models.CharField(blank=True, help_text='Which cluster/term', max_length=100)),
                ('delivery_sequence', models.JSONField(default=dict, help_text='Week-by-week delivery plan')),
                ('prerequisites', models.JSONField(default=list, help_text='Required prior units')),
                ('assessment_plan', models.JSONField(default=list, help_text='Assessment plan summary (deprecated - use assessment_tasks relation)')),
                ('mapping_matrix', models.JSONField(default=dict, help_text='Elements/PC/KE/FS → tasks → instruments')),
                ('resources', models.JSONField(default=list, help_text='Specific resources for this unit')),
                ('cohort_context', models.TextField(blank=True, help_text='How this unit suits the cohort')),
                ('industry_relevance', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('review', 'In Review'), ('approved', 'Approved'), ('published', 'Published'), ('archived', 'Archived')], default='draft', max_length=20)),
                ('version', models.IntegerField(default=1)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('course_tas', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='unit_tas_set', to='tas.coursetas')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='unit_tas_created', to=settings.AUTH_USER_MODEL)),
                ('facilities', models.ManyToManyField(blank=True, related_name='unit_tas_assignments', to='tas.facility')),
                ('trainers', models.ManyToManyField(blank=True, related_name='unit_tas_assignments', to='tas.trainer')),
            ],
            options={
                'verbose_name': 'Unit TAS',
                'verbose_name_plural': 'Unit TAS Documents',
                'db_table': 'tas_unit_tas',
                'ordering': ['cluster_assignment', 'unit_code'],
            },
        ),
        migrations.CreateModel(
            name='AssessmentTask',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('task_number', models.IntegerField()),
                ('task_name', models.CharField(max_length=300)),
                ('task_type', models.CharField(choices=[('knowledge', 'Knowledge Assessment'), ('practical', 'Practical Demonstration'), ('project', 'Project'), ('portfolio', 'Portfolio'), ('observation', 'Workplace Observation'), ('case_study', 'Case Study'), ('simulation', 'Simulation')], max_length=50)),
                ('description', models.TextField()),
                ('elements_covered', models.JSONField(default=list, help_text='Element codes covered')),
                ('performance_criteria_covered', models.JSONField(default=list, help_text='PC codes covered')),
                ('knowledge_evidence_covered', models.JSONField(default=list, help_text='KE items covered')),
                ('foundation_skills_covered', models.JSONField(default=list, help_text='FS items covered')),
                ('instructions', models.TextField(blank=True)),
                ('resources_required', models.JSONField(default=list)),
                ('time_allowed', models.CharField(blank=True, max_length=100)),
                ('instruments', models.JSONField(default=list, help_text='Assessment instruments/tools used')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('unit_tas', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='assessment_tasks', to='tas.unittas')),
            ],
            options={
                'verbose_name': 'Assessment Task',
                'verbose_name_plural': 'Assessment Tasks',
                'db_table': 'tas_assessment_tasks',
                'ordering': ['unit_tas', 'task_number'],
            },
        ),
        migrations.CreateModel(
            name='ComplianceCheck',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('entity_type', models.CharField(choices=[('course', 'Course TAS'), ('unit', 'Unit TAS')], max_length=20)),
                ('entity_id', models.IntegerField(help_text='ID of CourseTAS or UnitTAS')),
                ('status', models.CharField(choices=[('red', 'Red - Issue Found'), ('amber', 'Amber - Warning'), ('green', 'Green - Compliant')], max_length=20)),
                ('message', models.TextField(help_text='Compliance check message')),
                ('details', models.JSONField(default=dict, help_text='Detailed check results')),
                ('resolved', models.BooleanField(default=False)),
                ('resolution_notes', models.TextField(blank=True)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('checked_at', models.DateTimeField(auto_now_add=True)),
                ('resolved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='compliance_resolutions', to=settings.AUTH_USER_MODEL)),
                ('rule', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='checks', to='tas.compliancerule')),
            ],
            options={
                'verbose_name': 'Compliance Check',
                'verbose_name_plural': 'Compliance Checks',
                'db_table': 'tas_compliance_checks',
                'ordering': ['-checked_at'],
                'indexes': [models.Index(fields=['entity_type', 'entity_id', 'status'], name='tas_complia_entity__d0c258_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='coursetas',
            index=models.Index(fields=['tenant', 'status'], name='tas_course__tenant__f7a4a8_idx'),
        ),
        migrations.AddIndex(
            model_name='coursetas',
            index=models.Index(fields=['tenant', 'qualification_code'], name='tas_course__tenant__dd69fa_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='coursetas',
            unique_together={('tenant', 'qualification_code', 'version')},
        ),
        migrations.AlterUniqueTogether(
            name='trainer',
            unique_together={('tenant', 'user')},
        ),
        migrations.AddIndex(
            model_name='unittas',
            index=models.Index(fields=['course_tas', 'status'], name='tas_unit_ta_course__270ac8_idx'),
        ),
        migrations.AddIndex(
            model_name='unittas',
            index=models.Index(fields=['unit_code'], name='tas_unit_ta_unit_co_20cd9c_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='unittas',
            unique_together={('course_tas', 'unit_code', 'version')},
        ),
        migrations.AlterUniqueTogether(
            name='assessmenttask',
            unique_together={('unit_tas', 'task_number')},
        ),
    ]
