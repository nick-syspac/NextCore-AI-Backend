# Generated by Django 5.1.2 on 2025-10-24 07:13

import django.db.models.deletion
import django.utils.timezone
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='InterventionRule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('rule_number', models.CharField(db_index=True, max_length=50, unique=True)),
                ('tenant', models.CharField(db_index=True, max_length=100)),
                ('rule_name', models.CharField(max_length=200)),
                ('description', models.TextField()),
                ('is_active', models.BooleanField(default=True)),
                ('priority', models.IntegerField(default=1)),
                ('condition_type', models.CharField(choices=[('attendance', 'Attendance Threshold'), ('grade', 'Grade Threshold'), ('submission', 'Submission Pattern'), ('engagement', 'Engagement Level'), ('risk_score', 'Risk Score'), ('duration', 'Time-based'), ('composite', 'Multiple Conditions')], max_length=50)),
                ('conditions', models.JSONField(default=dict)),
                ('intervention_type', models.CharField(max_length=50)),
                ('priority_level', models.CharField(default='medium', max_length=20)),
                ('assigned_to_role', models.CharField(blank=True, max_length=100)),
                ('notify_staff', models.BooleanField(default=True)),
                ('notification_recipients', models.JSONField(default=list)),
                ('notification_template', models.TextField(blank=True)),
                ('compliance_requirement', models.CharField(blank=True, max_length=200)),
                ('last_triggered', models.DateTimeField(blank=True, null=True)),
                ('trigger_count', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'ordering': ['-priority', 'rule_name'],
            },
        ),
        migrations.CreateModel(
            name='InterventionWorkflow',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('workflow_number', models.CharField(db_index=True, max_length=50, unique=True)),
                ('tenant', models.CharField(db_index=True, max_length=100)),
                ('workflow_name', models.CharField(max_length=200)),
                ('description', models.TextField()),
                ('intervention_types', models.JSONField(default=list)),
                ('is_active', models.BooleanField(default=True)),
                ('steps', models.JSONField(default=list)),
                ('requires_approval', models.BooleanField(default=False)),
                ('approval_roles', models.JSONField(default=list)),
                ('required_documentation', models.JSONField(default=list)),
                ('compliance_standard', models.CharField(blank=True, max_length=200)),
                ('audit_requirements', models.JSONField(default=list)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'ordering': ['workflow_name'],
            },
        ),
        migrations.CreateModel(
            name='Intervention',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('intervention_number', models.CharField(db_index=True, max_length=50, unique=True)),
                ('tenant', models.CharField(db_index=True, max_length=100)),
                ('student_id', models.CharField(db_index=True, max_length=100)),
                ('student_name', models.CharField(max_length=200)),
                ('course_id', models.CharField(blank=True, max_length=100)),
                ('course_name', models.CharField(blank=True, max_length=200)),
                ('intervention_type', models.CharField(choices=[('academic_support', 'Academic Support'), ('attendance_followup', 'Attendance Follow-up'), ('wellbeing_check', 'Wellbeing Check'), ('behaviour_management', 'Behaviour Management'), ('career_guidance', 'Career Guidance'), ('extension_approval', 'Extension Approval'), ('special_consideration', 'Special Consideration'), ('re_engagement', 'Re-engagement'), ('progress_review', 'Progress Review'), ('referral', 'Referral to Services')], max_length=50)),
                ('priority_level', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('urgent', 'Urgent')], default='medium', max_length=20)),
                ('status', models.CharField(choices=[('initiated', 'Initiated'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('escalated', 'Escalated'), ('closed', 'Closed'), ('cancelled', 'Cancelled')], default='initiated', max_length=20)),
                ('trigger_type', models.CharField(choices=[('manual', 'Manual Entry'), ('rule_engine', 'Rule Engine Auto-trigger'), ('system_alert', 'System Alert'), ('third_party', 'Third Party Referral')], default='manual', max_length=50)),
                ('trigger_rule_id', models.CharField(blank=True, max_length=100)),
                ('trigger_details', models.JSONField(default=dict)),
                ('action_description', models.TextField()),
                ('action_taken_by', models.CharField(max_length=200)),
                ('action_taken_by_role', models.CharField(blank=True, max_length=100)),
                ('action_date', models.DateTimeField(default=django.utils.timezone.now)),
                ('communication_method', models.CharField(blank=True, choices=[('face_to_face', 'Face to Face'), ('phone_call', 'Phone Call'), ('email', 'Email'), ('video_call', 'Video Call'), ('sms', 'SMS'), ('written_note', 'Written Note'), ('lms_message', 'LMS Message')], max_length=50)),
                ('communication_notes', models.TextField(blank=True)),
                ('outcome_achieved', models.CharField(choices=[('successful', 'Successful'), ('partial', 'Partially Successful'), ('unsuccessful', 'Unsuccessful'), ('pending', 'Pending'), ('not_applicable', 'Not Applicable')], default='pending', max_length=20)),
                ('outcome_description', models.TextField(blank=True)),
                ('outcome_evidence', models.JSONField(default=list)),
                ('requires_followup', models.BooleanField(default=False)),
                ('followup_date', models.DateField(blank=True, null=True)),
                ('followup_notes', models.TextField(blank=True)),
                ('referred_to', models.CharField(blank=True, max_length=200)),
                ('referral_accepted', models.BooleanField(blank=True, null=True)),
                ('referral_date', models.DateField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('audit_notes', models.TextField(blank=True)),
                ('compliance_category', models.CharField(blank=True, max_length=100)),
                ('attachments', models.JSONField(default=list)),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['tenant', 'student_id', '-created_at'], name='interventio_tenant_239ae4_idx'), models.Index(fields=['status', 'priority_level'], name='interventio_status_8e4ef3_idx'), models.Index(fields=['trigger_type', 'intervention_type'], name='interventio_trigger_340a03_idx')],
            },
        ),
        migrations.CreateModel(
            name='InterventionOutcome',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('outcome_number', models.CharField(db_index=True, max_length=50, unique=True)),
                ('metric_type', models.CharField(choices=[('attendance_improvement', 'Attendance Improvement'), ('grade_improvement', 'Grade Improvement'), ('engagement_increase', 'Engagement Increase'), ('behaviour_change', 'Behaviour Change'), ('completion_rate', 'Completion Rate'), ('satisfaction', 'Satisfaction'), ('custom', 'Custom Metric')], max_length=50)),
                ('baseline_value', models.FloatField(blank=True, null=True)),
                ('target_value', models.FloatField(blank=True, null=True)),
                ('actual_value', models.FloatField(blank=True, null=True)),
                ('measurement_date', models.DateField(default=django.utils.timezone.now)),
                ('improvement_percentage', models.FloatField(blank=True, null=True)),
                ('target_achieved', models.BooleanField(blank=True, null=True)),
                ('impact_rating', models.CharField(blank=True, choices=[('significant', 'Significant Impact'), ('moderate', 'Moderate Impact'), ('minimal', 'Minimal Impact'), ('none', 'No Impact'), ('negative', 'Negative Impact')], max_length=20)),
                ('evidence_description', models.TextField(blank=True)),
                ('evidence_links', models.JSONField(default=list)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('intervention', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='outcomes', to='intervention_tracker.intervention')),
            ],
            options={
                'ordering': ['-measurement_date'],
            },
        ),
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('log_number', models.CharField(db_index=True, max_length=50, unique=True)),
                ('tenant', models.CharField(db_index=True, max_length=100)),
                ('action_type', models.CharField(choices=[('created', 'Intervention Created'), ('updated', 'Intervention Updated'), ('status_changed', 'Status Changed'), ('step_completed', 'Workflow Step Completed'), ('outcome_recorded', 'Outcome Recorded'), ('document_attached', 'Document Attached'), ('notification_sent', 'Notification Sent'), ('escalated', 'Escalated'), ('closed', 'Closed')], max_length=50)),
                ('action_description', models.TextField()),
                ('performed_by', models.CharField(max_length=200)),
                ('performed_by_role', models.CharField(blank=True, max_length=100)),
                ('changes', models.JSONField(default=dict)),
                ('ip_address', models.CharField(blank=True, max_length=45)),
                ('user_agent', models.CharField(blank=True, max_length=500)),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('intervention', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='audit_logs', to='intervention_tracker.intervention')),
            ],
            options={
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['tenant', 'intervention', '-timestamp'], name='interventio_tenant_6c9a81_idx'), models.Index(fields=['action_type', '-timestamp'], name='interventio_action__edf0f7_idx')],
            },
        ),
        migrations.CreateModel(
            name='InterventionStep',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('step_number', models.IntegerField()),
                ('step_name', models.CharField(max_length=200)),
                ('step_description', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('skipped', 'Skipped'), ('blocked', 'Blocked')], default='pending', max_length=20)),
                ('completed_by', models.CharField(blank=True, max_length=200)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('completion_notes', models.TextField(blank=True)),
                ('duration_minutes', models.IntegerField(blank=True, null=True)),
                ('evidence_provided', models.JSONField(default=list)),
                ('attachments', models.JSONField(default=list)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('intervention', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='workflow_steps', to='intervention_tracker.intervention')),
                ('workflow', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='intervention_tracker.interventionworkflow')),
            ],
            options={
                'ordering': ['intervention', 'step_number'],
                'unique_together': {('intervention', 'step_number')},
            },
        ),
    ]
